= stylesheet_link_tag 'jquery.ui/smoothness/jquery-ui-1.8.23.custom', 'elfinder'
= javascript_include_tag 'http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js'
= javascript_include_tag 'http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js'
= javascript_include_tag 'elfinder'

:javascript
  // Helper function to get parameters from the query string.
  function getUrlParam(paramName) {
      var reParam = new RegExp('(?:[\?&]|&amp;)' + paramName + '=([^&]+)', 'i') ;
      var match = window.location.search.match(reParam) ;

      return (match && match.length > 1) ? match[1] : '' ;
  }

  $().ready(function() {
      var funcNum = getUrlParam('CKEditorFuncNum');

      var elf = $('#elfinder').elfinder({
          url : '/filemanager/elfinder',
          getFileCallback : function(file) {
              window.opener.CKEDITOR.tools.callFunction(funcNum, file);
              window.close();
          },
          resizable: false
      }).elfinder('instance');
  });

  $(function() {
    var rails_csrf = {};
    rails_csrf[$('meta[name=csrf-param]').attr('content')] = $('meta[name=csrf-token]').attr('content');

    var elf = $('#elfinder').elfinder({
      url: '/filemanager/elfinder',
      transport : new elFinderSupportVer1(),
      customData: rails_csrf,
      getFileCallback: function(url) { // editor callback
        FileBrowserDialogue.mySubmit(url); // pass selected file path to TinyMCE
      }
    }).elfinder('instance');
  })

#elfinder
